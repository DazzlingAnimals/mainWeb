const HERO_CONTENT = {
  title: "DAZZLING ANIMALS",
  subtitle: "Face your own brilliance.",
  description:
    "12 animals facing their dazzling moments. Through these sunglasses, they recognize their own light and become guardians protecting your inner self.",
};

const INTRO_CONTENT = {
  title: "FACE YOUR LIGHT",
  text: [
    "We often pass by our own shining moments without ever recognizing them. Like hidden potential, silent dedication, or the precious wisdom gained at the end of pain, the most valuable light is often too familiar or too blindingly bright to perceive on our own.",
    "Animals are no different. Within their pure and beautiful lives, there comes a 'Dazzling Moment' so brilliant that it is sometimes hard to bear. We gifted them sunglasses so they could clearly recognize their own light and fully enjoy its value.",
    "Now, shaking off the blinding gaze of the world, they face their own brilliance with confidence. 'Dazzling Animals' NFT is a limited-edition record capturing those blinding moments.",
  ],
};

const ANIMALS_DATA = [
  {
    month: 1,
    name: "Ox",
    imageFile: "Ox.png",
    subName: "Zodiac: Ox",
    title: "Unchanging Value",
    color: "#CA5E59",
    theme: "Clearing the Past",
    meaning:
      "When you feel empty from the unchanging, lonely reality of the new year, this NFT offers comfort by reminding you that your consistent daily life is the most precious and solid value that brings luck and fortune.",
    story:
      "The Ox was trapped in the prejudice that the nose ring was merely a 'means of control and restraint,' destined only to pull a plow. In January, while all other animals shared New Year's celebrations, the Ox faced the unchanging cycle of labor, suffering from a deep sense of emptiness. Overcome by the loneliness of thinking, 'Even with the New Year, my weary life remains the same,' he stepped into the barn to rest. There, next to the plow, he discovered a shiny new nose ring carefully packed inside a fancy gift box. Puzzled, he opened the box and found a letter: 'This ring is no longer a restraint, but a symbol of the precious tribute that calls forth fortune, peace, and abundance.' The Ox realized the truth. The nose ring was not a shackle, but a symbol of blessingâ€”proof that his silent, steadfast existence brought consistent fortune and stability to people's lives. Blinded by the light of that sublime dedication, we gifted him sunglasses. Now, shaking off his emptiness, the Ox stands tall as an unchanging hero through sunglasses that capture his noble value.",
  },
  {
    month: 2,
    name: "Lion",
    imageFile: "Lion.png",
    subName: "Zodiac: Tiger",
    title: "The Value of Existence",
    color: "#1a1717ff",
    textColor: "text-white",
    theme: "Dynamic Energy",
    meaning:
      "To you, exhausted from trying to meet the world's standards, this NFT deeply comforts you by saying you don't need to achieve or prove anythingâ€”just being your living, breathing self is already perfect and dazzlingly precious.",
    story:
      "The Lion, King of the Jungle, lived crushed under the weight of his crownâ€”the prejudice that he must always appear strong and majestic. In February, as other animals raced fiercely toward new goals, he found himself frozen, unable to take a single step due to the overwhelming pressure and obsession with perfection. 'Everyone else is forging ahead; am I the only one left behind?' This thought drove him into a deeper solitude. One day, he set down his heavy, invisible crown and sat alone in a quiet cave. In that silence, he realized that even without the crown, his shadow alone commanded immense majesty in the eyes of others. Dazzled by the realization that true strength comes not from titles but from his very existence, we gifted him sunglasses. Now, filtering out excessive expectations and embracing his true charisma, the Lion is reborn as a burden-free king, understanding that his presence alone is majestic enough, without needing to race alongside others.",
  },
  {
    month: 3,
    name: "Rabbit",
    imageFile: "Rabbit.png",
    subName: "Zodiac: Rabbit",
    title: "The Fortune of Sensitivity",
    color: "#EBEBEB",
    textColor: "text-black",
    theme: "Pure Vitality",
    meaning:
      "To you, worn out by the world's anxiety and noise, this NFT offers comfort by showing that your sensitivity is actually a superpower that helps you find the greatest luck.",
    story:
      "The Rabbit was always mocked for being 'timid and weak.' However, his true struggle was the pain of 'excessive sensitivity'â€”perceiving every stimulus in the world with overwhelming clarity. In March, as nature awakened with a cacophony of sounds and movements, the Rabbit's sensitivity peaked. His keen senses detected danger faster than anyone, but at the cost of constant, exhausting vigilance. Every noise and slight movement felt like a disaster warning, leaving him trapped in sensory overload and relentless anxiety. One day, pausing to burrow into the ground and escape the overwhelming stimuli, he spotted a vibrant four-leaf clover hidden in the grass. In that brief moment of perfect stillness, he realized that his heightened focus wasn't fearâ€”it was a superpower that protected him and revealed the world's small, beautiful fortunes. Blinded by the light of this peaceful realization, we gifted him sunglasses. Now, through sunglasses that capture moments of peace, the Rabbit has overcome his sensitivity and fear, finding the greatest stability through his sharpest senses and becoming a complete hero.",
  },
  {
    month: 4,
    name: "Chameleon",
    imageFile: "Chameleon.png",
    subName: "Zodiac: Dragon",
    title: "Courage to Love Myself",
    color: "#1D649A",
    theme: "Clear Skies",
    meaning:
      "To you, who wears masks to fit the world's demands, this NFT tells you that you are a complete being embracing all those colors, giving you the courage to choose your own light at any time.",
    story:
      "The Chameleon was trapped in the prejudice of being a creature that constantly wears masks to fit its surroundings. In April, under the clear sky filled with new hopes and goals, he endlessly changed colors to meet the expectations of others, thinking 'I must have a cool color like them,' eventually forgetting his own true color. Living in constant transformation, he suffered from the painful shame of feeling like 'a being without an original color, living behind a transparent mask.' Mimicking too many colors blurred his identity, and under extreme pressure, he fell into deep helplessness, unable to change into any color at all. Just then, he discovered a paint palette dropped by a painter in the forest. Seeing the myriad of pure colors, he realized that his true self was not a single color to hide behind, but the ability to possess all colors like the palette and 'choose to radiate light himself.' Blinded by the light of this realization, we gifted him sunglasses. Now, through sunglasses that capture true courage instead of prejudice, the Chameleon has become a complete hero who embraces all colors.",
  },
  {
    month: 5,
    name: "Snake",
    imageFile: "Snake.png",
    subName: "Zodiac: Snake",
    title: "A Better Me",
    color: "#39A14F",
    theme: "Abundance",
    meaning:
      "When you are exhausted by the pain and burden of growth, this NFT comforts you by reminding you that all your suffering is an essential process to shed your old self and be reborn as a better being.",
    story:
      "The Snake has long suffered from the prejudice of being 'cunning and dangerous.' In May, amidst the pressure for all life to thrive, he endured the 'pain of change.' He feared that bearing the burden of growth would leave him forever isolated in this prejudice. One day, after his most painful shedding, he found an hourglass beside his old skin. He realized that his shedding was not defying time, but the 'wisdom of rebirth'â€”fiercely living through time to discard the old self and become new. He saw that true strength lies in the 'courage to accept the pain of growth.' Blinded by this realization, we gifted him sunglasses. Now, wearing sunglasses that hold the insight of growth, the Snake is a hero who never stops, even in pain.",
  },
  {
    month: 6,
    name: "Camel",
    imageFile: "Camel.png",
    subName: "Zodiac: Horse",
    title: "The Power of the Back",
    color: "#F7C93C",
    theme: "The Center",
    meaning:
      "When you feel like you're walking alone with a heavy burden, this NFT comforts you by reminding you that your silent effort is actually the 'clearest milestone' showing the way for others.",
    story:
      "The Camel was trapped in the prejudice of being a mere 'burden carrier,' silently hauling loads across the endless desert. In June, past the year's midpoint and exhausted by the weary journey, he felt his efforts were meaningless and began to lose his center, yet he persisted with painful steps. One day, after completing his most agonizing crossing, lost merchants approached him at an oasis, showing a worn map. 'We were lost,' they said, 'but by following your steadfast footprints, we kept our hope and made it here.' At that moment, the Camel realized his painful steps were actually a **'milestone of hope' guiding those who had fallen into despair.** Blinded by the light of this realization, we gifted him sunglasses. Now, through sunglasses that remain unshaken in endless adversity, the Camel is reborn as a complete hero, steadfastly moving forward carrying the hope of all.",
  },
  {
    month: 7,
    name: "Goat",
    imageFile: "Goat.png",
    subName: "Zodiac: Sheep",
    title: "The Purest Inner Self",
    color: "#E03D40",
    theme: "Overcoming Negativity",
    meaning:
      "Even if you feel you don't fit in with the world, this NFT comforts you by reminding you that within you lies the purest and most beautiful light, and you are a good person just as you are.",
    story:
      "The Goat was trapped in the terrible prejudice of being a symbol of evil due to his 'unfocused eyes.' In July, a time of complex emotions where achievement and frustration intersect, people shunned him, blaming their own anxieties on his gaze. To escape this misunderstanding, the Goat climbed to the highest, purest peak. In that absolute solitude, he realized his eyes were not unfocused but were capturing the vast, pure starlight unseen from the ground, undisturbed by the world's false lights. He understood his gaze was a gift to protect the world's most beautiful truths. Blinded by this realization, we gifted him sunglasses. Now, through sunglasses that filter out the world's misunderstandings, the Goat shines as a hero in the most solitary place.",
  },
  {
    month: 8,
    name: "Monkey",
    imageFile: "Monkey.png",
    subName: "Zodiac: Monkey",
    title: "Humor That Brings Hope",
    color: "#FFD700",
    theme: "Harvest",
    meaning:
      "This NFT helps you realize that your very existence is the purest comfort and 'hope that keeps life going' for someone else.",
    story:
      "The Monkey was trapped in the prejudice of being a 'caricature for ridicule,' a mere tool for stress relief in the zoo. In August, as the season of fruition approached, he fell deep into anxiety about the worth of his achievements and the loneliness of being just a source of amusement. One day, he picked up an old camera dropped by a visitor. Curious, he pressed the play button and saw images of people laughing brightly at him. In their laughter, he saw deep fatigue and the weariness of life. He realized that their laughter was not ridicule, but **the purest 'hope for survival,' a moment to forget despair and gain the strength to live on.** He understood that his antics provided the energy needed to sustain someone's life. Blinded by the light of this realization, we gifted him sunglasses. Now, through sunglasses that capture true humor rather than prejudice, the Monkey has become a hero who discovers the value of hope in his own existence.",
  },
  {
    month: 9,
    name: "Giraffe",
    imageFile: "Giraffe.png",
    subName: "Zodiac: Rooster",
    title: "Happiness Nearby",
    color: "#EBBC6B",
    theme: "Maturity",
    meaning:
      "To you, who always looked at things far away, this NFT comforts you by reminding you not to miss the happiness right next to you.",
    story:
      "The Giraffe, always standing a head taller than others, was trapped in the prejudice that he could 'only see things far away.' In September, under the expectations of family and society, he suffered from the loneliness of chasing 'idealistic goals' while missing the precious reality close at hand. He often overlooked the small happiness right beneath his feet. One day, bending down to drink, he discovered a tiny, shining flower beside his hoof. Realizing this small flower was more beautiful than any distant view, he was dazzled by the brilliant happiness it radiated. We gifted him sunglasses to fully enjoy this joy. Now, through sunglasses that help him see the beauty of what is near, the Giraffe has been reborn as a true hero who discovers the most dazzling happiness in the closest places.",
  },
  {
    month: 10,
    name: "Polar Bear",
    imageFile: "PolarBear.png",
    subName: "Zodiac: Dog",
    title: "Hope Blooming Anywhere",
    color: "#EB5B7D",
    theme: "Happiness",
    meaning:
      "To you, feeling anxious in a changing world, this NFT shows that every footstep you take is a path of hope and that adaptation is the greatest courage.",
    story:
      "The Polar Bear lived in deep anxiety, trapped in the prejudice that he 'must live only on ice forever,' fearing his life would end with the melting glaciers. In October, amidst the harvest and feasts, he felt a fundamental anxiety: 'Am I truly happy? Can I adapt to this change?' One day, on a small patch of soil revealed by melting ice, he discovered a tiny sprout rooted firmly. This sprout showed that life begins even where ice disappears. The Polar Bear realized he was a resilient hero capable of pioneering life on new land, not just ice. Blinded by the light of that hope, we gifted him sunglasses. Now, through sunglasses that filter out past obsessions and capture the courage for new beginnings, the Polar Bear is reborn as a true hero leaving footprints of hope amidst change.",
  },
  {
    month: 11,
    name: "Sloth",
    imageFile: "Sloth.png",
    subName: "Zodiac: Pig",
    title: "My Own Pace",
    color: "#89236A",
    theme: "Reflection",
    meaning:
      "To you, tired of the world's fast pace, this NFT gifts you time to stop and look back at yourself, helping you reflect on your noble inner values.",
    story:
      "The Sloth always suffered from the cold prejudice of being a 'lazy failure' simply because he was slow. As everyone sped up ahead of the year-end in November, he was plagued by guilt, wondering, 'Is it okay for me to be the only one slowing down?' Always hitting the limit of his innate speed, he eventually collapsed on the cold ground, overwhelmed by defeat and self-blame. While catching his breath and agonizing, 'Why can't I even run like others?', a stunning scene caught his eye. It was the elegant dance of a sunflower slowly turning its head to follow the sunâ€”something those rushing past could never see. He realized that his slowness was not incompetence, but a 'noble privilege' to fully savor the depth and beauty of the world that others miss. Blinded by the light of this realization, we gifted him sunglasses. Now, through sunglasses that protect his own rhythm, the Sloth is reborn as a proud hero, unmoved by the world's speed.",
  },
  {
    month: 12,
    name: "Fox",
    imageFile: "Fox.png",
    subName: "Zodiac: Rat",
    title: "The One Who Believes in Me",
    color: "#469EDE",
    theme: "Wisdom",
    meaning:
      "Even when the world feels full of doubt and lies, this NFT comforts you by reminding you to lay down your anxiety for a moment because there is someone who purely believes in and loves you.",
    story:
      "The Fox was a hero living cleverly in a city rife with deception. In December, during the longest and coldest nights, he viewed the world with distrust and vigilance. People saw him through the prejudice of a 'cunning liar,' and he pierced through their hidden agendas with his sharp gaze. One day, sitting alone in a bustling market, a child quietly approached. Despite the Fox's wary glare, the child gently placed a transparent crystal in front of him with a smile. The Fox was overwhelmed not by the crystal's clarity, but by the child's pure trust, free of suspicion. Through the child's innocent gaze, he experienced a 'dazzling moment' where all the world's distorted lights and false shadows vanished. He realized that true wisdom comes not from trickery, but from 'a single pure belief.' Blinded by this realization, we gifted him sunglasses. Now, through sunglasses that filter out falsehoods and capture only the truth, the Fox is reborn as a true hero for those who believe in him.",
  },
];

/* --- State --- */
const state = {
  isMenuOpen: false,
  scrolled: false,

  selectedAnimal: null,

  isConnected: false,
  walletAddress: "",
  ethBalance: "0.00",

  activeIndex: 0,
  isDragging: false,
  startX: 0,
};

/* --- DOM refs --- */
const $ = (id) => document.getElementById(id);

const navEl = $("nav");
const mobileMenuBtn = $("mobileMenuBtn");
const mobileMenu = $("mobileMenu");

const walletDesktop = $("walletDesktop");
const walletMobileBtn = $("walletMobileBtn");

const heroDescSmall = $("heroDescSmall");
const introText = $("introText");

const sliderViewport = $("sliderViewport");
const sliderTrack = $("sliderTrack");
const sliderDots = $("sliderDots");
const paletteStrip = $("paletteStrip");

const collectionGrid = $("collectionGrid");

const modal = $("modal");
const modalOverlay = $("modalOverlay");
const modalClose = $("modalClose");
const modalMedia = $("modalMedia");
const modalMediaImg = $("modalMediaImg");
const modalName = $("modalName");
const modalSub = $("modalSub");
const modalMonth = $("modalMonth");
const modalTheme = $("modalTheme");
const modalTitle = $("modalTitle");
const modalMeaning = $("modalMeaning");
const modalStory = $("modalStory");

/* ============ Helpers ============ */
function shortAddr(addr) {
  // 0x71C...9A23 í˜•íƒœ (React ë²„ì „ ìœ ì§€)
  if (!addr || addr.length < 10) return addr;
  return `${addr.slice(0, 5)}...${addr.slice(-4)}`;
}

function clamp(n, min, max) {
  return Math.max(min, Math.min(max, n));
}

function setBodyScrollLocked(locked) {
  document.body.style.overflow = locked ? "hidden" : "";
}

function rerenderIcons() {
  // lucide is global from CDN
  if (window.lucide && typeof window.lucide.createIcons === "function") {
    window.lucide.createIcons();
  }
}

/* ============ Nav / Mobile Menu ============ */
function renderNav() {
  const nav = $("nav");
  if (!nav) return;

  nav.classList.toggle("nav--scrolled", state.scrolled);

  // Mobile icon toggle
  mobileMenuBtn.setAttribute("aria-label", state.isMenuOpen ? "Close menu" : "Open menu");
  mobileMenuBtn.classList.toggle("active", state.isMenuOpen);  // ðŸ” X ì• ë‹ˆë©”ì´ì…˜ìš©

  mobileMenu.classList.toggle("hidden", !state.isMenuOpen);
  mobileMenu.classList.toggle("animate-fade-in-down", state.isMenuOpen);

  mobileMenu.classList.toggle("hidden", !state.isMenuOpen);
  mobileMenu.classList.toggle("animate-fade-in-down", state.isMenuOpen);

  // If real wallet/mint UI is handled by wallet.js/mint.js, do not override wallet UI here.
  if (window.__MINT_UI_MANAGED_BY_MINT_JS__) return;

  // Mobile wallet button label
  walletMobileBtn.textContent = state.isConnected ? shortAddr(state.walletAddress) : "Connect Wallet";

  // Desktop wallet slot
  walletDesktop.innerHTML = "";
  if (!state.isConnected) {
    const btn = document.createElement("button");
    btn.className = "walletBtn";
    btn.type = "button";
    btn.innerHTML = `<i data-lucide="wallet" class="ico"></i> Connect Wallet`;
    btn.addEventListener("click", connectWallet);
    walletDesktop.appendChild(btn);
  } else {
    const pill = document.createElement("div");
    pill.className = "walletPill";
    pill.innerHTML = `
      <div class="walletPill__col">
        <span class="walletPill__label">BALANCE</span>
        <span class="walletPill__bal">${state.ethBalance} ETH</span>
      </div>
      <div class="walletPill__divider"></div>
      <div class="walletPill__addr">
        <div class="walletPill__dot" aria-hidden="true"></div>
        <span style="font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-weight:900; color:#374151;">
          ${shortAddr(state.walletAddress)}
        </span>
      </div>
    `;
    walletDesktop.appendChild(pill);
  }

  rerenderIcons();
}

function toggleMobileMenu() {
  state.isMenuOpen = !state.isMenuOpen;
  renderNav();
}

/* ============ Wallet (Simulation) ============ */
let connectTimer = null;
function connectWallet() {
  if (state.isConnected) return;

  // ì¤‘ë³µ í´ë¦­ ë°©ì§€
  if (connectTimer) return;

  // Simulate async connect
  connectTimer = window.setTimeout(() => {
    state.isConnected = true;
    state.walletAddress = "0x71C0000000000000000000000000000000009A23"; // mock
    state.ethBalance = "1.45"; // mock
    connectTimer = null;

    renderNav();
  }, 800);
}

/* ============ Hero Content ============ */
function renderHeroAndStory() {
  heroDescSmall.textContent = HERO_CONTENT.description;

  introText.innerHTML = ""; // only constant data, safe to render via text nodes too
  INTRO_CONTENT.text.forEach((p) => {
    const el = document.createElement("p");
    el.textContent = p;
    introText.appendChild(el);
  });
}

/* ============ Slider ============ */
function buildSlider() {
  sliderTrack.innerHTML = "";
  sliderDots.innerHTML = "";
  paletteStrip.innerHTML = "";

  ANIMALS_DATA.forEach((animal, index) => {
    // Card
    const card = document.createElement("div");
    card.className = "sliderCard";
    card.dataset.index = String(index);

    const media = document.createElement("div");
    media.className = "sliderCard__media";
    media.style.backgroundColor = animal.color;

    const shade = document.createElement("div");
    shade.className = "sliderCard__shade";

    const center = document.createElement("div");
    center.className = "sliderCard__center";

    const img = document.createElement("img");
    img.className = "sliderCard__icon"; // reuse sizing styles
    img.src = `./img/${animal.imageFile || animal.name.replace(/\s+/g, "") + ".png"}`;
    img.alt = animal.name;
    img.loading = "lazy";
    img.decoding = "async";

    center.appendChild(img);
    media.appendChild(shade);
    media.appendChild(center);

    const body = document.createElement("div");
    body.className = "sliderCard__body";

    const name = document.createElement("div");
    name.className = "sliderCard__name";
    name.textContent = animal.name;

    const month = document.createElement("div");
    month.className = "sliderCard__month";
    month.textContent = `MONTH ${String(animal.month).padStart(2, "0")}`;

    body.appendChild(name);
    body.appendChild(month);

    card.appendChild(media);
    card.appendChild(body);

    sliderTrack.appendChild(card);

    // Dots
    const dot = document.createElement("div");
    dot.className = "dot2";
    dot.dataset.index = String(index);
    sliderDots.appendChild(dot);

    // Palette dots
    const pDot = document.createElement("div");
    pDot.className = "paletteDot";
    pDot.style.backgroundColor = animal.color;
    pDot.title = `${animal.month}. ${animal.name}`;
    pDot.dataset.index = String(index);

    // í´ë¦­ ì´ë²¤íŠ¸: í•´ë‹¹ ìŠ¬ë¼ì´ë“œë¡œ ì´ë™
    pDot.addEventListener("click", () => {
      state.activeIndex = index;
      renderSlider();
    });

    paletteStrip.appendChild(pDot);
  });

  rerenderIcons();
  renderSlider();
}

function renderSlider() {
  // Track translate: React ë¡œì§ ìœ ì§€
  sliderTrack.style.transform = `translateX(${25 - state.activeIndex * 55}%)`;

  // Active card styles
  const cards = sliderTrack.querySelectorAll(".sliderCard");
  cards.forEach((c, idx) => {
    c.classList.toggle("sliderCard--active", idx === state.activeIndex);
  });

  // Dots
  const dots = sliderDots.querySelectorAll(".dot2");
  dots.forEach((d, idx) => {
    d.classList.toggle("dot2--active", idx === state.activeIndex);
  });

  // Palette dots í™œì„±í™” í‘œì‹œ
  const paletteDots = paletteStrip.querySelectorAll(".paletteDot");
  paletteDots.forEach((pd, idx) => {
    pd.classList.toggle("paletteDot--active", idx === state.activeIndex);
  });
}

function nextSlide() {
  if (state.activeIndex < ANIMALS_DATA.length - 1) state.activeIndex += 1;
  else state.activeIndex = 0;
  renderSlider();
}

function prevSlide() {
  if (state.activeIndex > 0) state.activeIndex -= 1;
  else state.activeIndex = ANIMALS_DATA.length - 1;
  renderSlider();
}

// Drag & swipe
function onDragStart(e) {
  state.isDragging = true;
  const clientX = e.type.includes("mouse") ? e.clientX : e.touches[0].clientX;
  state.startX = clientX;
}
function onDragEnd(e) {
  if (!state.isDragging) return;
  state.isDragging = false;

  const clientX = e.type.includes("mouse")
    ? e.clientX
    : e.changedTouches[0].clientX;

  const diff = state.startX - clientX;
  const threshold = 50;

  if (diff > threshold) nextSlide();
  else if (diff < -threshold) prevSlide();
}

/* ============ Collection Grid + Modal ============ */
function buildCollection() {
  collectionGrid.innerHTML = "";

  ANIMALS_DATA.forEach((animal) => {
    const card = document.createElement("div");
    card.className = "card";
    card.tabIndex = 0;
    card.setAttribute("role", "button");
    card.setAttribute("aria-label", `Open ${animal.name}`);

    const isDarkText = animal.textColor === "text-black";

    const media = document.createElement("div");
    media.className = "card__media";
    media.style.backgroundColor = animal.color;

    const shade = document.createElement("div");
    shade.className = "card__mediaShade";

    const img = document.createElement("img");
    img.className = "card__img";
    img.src = `./img/${animal.imageFile || animal.name.replace(/\s+/g, "") + ".png"}`;
    img.alt = `${animal.name} artwork`;
    img.loading = "lazy";
    img.decoding = "async";

    const hover = document.createElement("div");
    hover.className = "card__hover";

    const hoverInner = document.createElement("div");
    const hoverTitle = document.createElement("h3");
    hoverTitle.className = "card__hoverTitle";
    hoverTitle.textContent = animal.title;

    const hoverLine = document.createElement("div");
    hoverLine.className = "card__hoverLine";

    hoverInner.appendChild(hoverTitle);
    hoverInner.appendChild(hoverLine);
    hover.appendChild(hoverInner);

    media.appendChild(img);
    media.appendChild(shade);
    media.appendChild(hover);

    const body = document.createElement("div");
    body.className = "card__body";

    const name = document.createElement("h3");
    name.className = "card__name";
    name.textContent = animal.name;

    const sub = document.createElement("p");
    sub.className = "card__sub";
    sub.textContent = animal.subName;

    const meaning = document.createElement("p");
    meaning.className = "card__meaning";
    meaning.textContent = animal.meaning;

    const cta = document.createElement("div");
    cta.className = "card__cta";
    cta.innerHTML = `Read Story <i data-lucide="chevron-right" style="width:14px;height:14px"></i>`;

    body.appendChild(name);
    body.appendChild(sub);
    body.appendChild(meaning);
    body.appendChild(cta);

    card.appendChild(media);
    card.appendChild(body);

    card.addEventListener("click", () => openModal(animal));
    card.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        openModal(animal);
      }
    });

    collectionGrid.appendChild(card);
  });

  rerenderIcons();
}

function openModal(animal) {
  state.selectedAnimal = animal;

  modalName.textContent = animal.name;
  modalSub.textContent = animal.subName;
  modalMonth.textContent = `MONTH ${String(animal.month).padStart(2, "0")}`;
  modalTheme.textContent = `THEME: ${animal.theme || "-"}`;

  modalTitle.textContent = animal.title;
  modalMeaning.textContent = animal.meaning;
  modalStory.textContent = animal.story;

  modalMedia.style.backgroundColor = animal.color;

  if (modalMediaImg) {
    modalMediaImg.src = `./img/${animal.imageFile || animal.name.replace(/\s+/g, "") + ".png"}`;
    modalMediaImg.alt = animal.name;
  }

  modal.classList.remove("hidden");
  setBodyScrollLocked(true);
  rerenderIcons();
}

function closeModal() {
  state.selectedAnimal = null;
  modal.classList.add("hidden");
  setBodyScrollLocked(false);
}

/* ============ Events / Init ============ */
function onScroll() {
  state.scrolled = window.scrollY > 50;
  renderNav();
}

function onAnchorClickCloseMenu(e) {
  // ëª¨ë°”ì¼ ë©”ë‰´ì—ì„œ ë§í¬ í´ë¦­ ì‹œ ë‹«ê¸°
  const a = e.target.closest("a");
  if (!a) return;
  if (!state.isMenuOpen) return;
  state.isMenuOpen = false;
  renderNav();
}

function init() {
  // initial content
  renderHeroAndStory();
  // ðŸ”¥ mint.jsê°€ UI ê´€ë¦¬
  window.__MINT_UI_MANAGED_BY_MINT_JS__ = true;


  // mint tabs are handled by mint.js (real on-chain status)
  if (!window.__MINT_UI_MANAGED_BY_MINT_JS__) {
    tabWhitelist.addEventListener("click", () => setMintPhase("whitelist"));
    tabPublic.addEventListener("click", () => setMintPhase("public"));
    setMintPhase(state.mintPhase);
  }

  // build slider / collection
  buildSlider();
  buildCollection();

  // nav events
  window.addEventListener("scroll", onScroll, { passive: true });
  mobileMenuBtn.addEventListener("click", toggleMobileMenu);
  mobileMenu.addEventListener("click", onAnchorClickCloseMenu);

  // mobile wallet button uses inline click -> connectBtn (wallet.js)

  // slider drag events
  sliderViewport.addEventListener("mousedown", onDragStart);
  sliderViewport.addEventListener("mouseup", onDragEnd);
  sliderViewport.addEventListener("mouseleave", onDragEnd);
  sliderViewport.addEventListener("touchstart", onDragStart, { passive: true });
  sliderViewport.addEventListener("touchend", onDragEnd);

  // modal events
  modalOverlay.addEventListener("click", closeModal);
  modalClose.addEventListener("click", closeModal);
  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && !modal.classList.contains("hidden")) closeModal();
  });

  // close mobile menu when resizing to desktop
  window.addEventListener("resize", () => {
    if (window.innerWidth >= 768 && state.isMenuOpen) {
      state.isMenuOpen = false;
      renderNav();
    }
  });

  // initial nav render
  renderNav();

  // icons
  rerenderIcons();
}

document.addEventListener("DOMContentLoaded", init);
